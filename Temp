# ===========================================================
# CCDataIndexAndPackagingUtility - Production Configuration
# ===========================================================
# Last Updated: 2025-12-19
# Updated to use CC_Extract_Staging table instead of Wawa_Doc_Migration_Transit_Data
# Optimized for high-volume production processing (2M+ documents/day)
# ===========================================================

# ===== APPLICATION SETTINGS =====
app.base_path=D:/Rameshwar/ClaimCenterDataMerge/
app.skipHeaderRow=true
app.archive.after.processing=true

# ===== BATCHING CONFIGURATION =====
# Set document count: Maximum documents per set
app.set.doc.count=25

# Force single set per batch
# true = Multiple batches per claim (1 set per batch)
# false = One batch per claim (multiple sets per batch)
app.batch.force.single.set=false

# ===== PERFORMANCE TUNING =====
# Thread Pool Size: Number of parallel CSV file processors
# Recommended: 5-10 for production (multiple CSV files)
# Note: Each thread processes one complete CSV file
app.thread.pool.size=5

# Progress Monitoring: Log progress every N minutes
# Set to 0 to disable progress monitoring
# Recommended: 5 minutes for production visibility
app.progress.log.interval.minutes=5

# ===== DOCUMENT TITLE CONFIGURATION =====
# If documentTitle (Name) is null/empty, set it from contentRetrievalName (without extension)
app.canSetDocTitleAsContentFileNameIfNULL=false

# Set gwDocumentID as empty during packaging (if needed)
app.setgwDocumentIDAsEmpty=false

# ===== DATABASE SETTINGS =====
db.serverName=RAMESHWAR\\SQLEXPRESS
db.port=1433
db.dbName=Wawa_DMS_Conversion_UAT

# Database Connection Pool Size
# IMPORTANT: Should be >= app.thread.pool.size + 5 (buffer for overhead)
# Recommended: 15-20 for production with 5 threads
db.pool.size=15

# Target table for indexing and packaging operations
# CHANGED: Now using CC_Extract_Staging instead of Wawa_Doc_Migration_Transit_Data
db.staging.claimcenterdbtable=Wawa_DMS_Conversion_UAT.[dbo].[CC_Extract_Staging]

# Batch UPDATE Size for Indexing: Number of rows per JDBC batch
# CRITICAL FOR PERFORMANCE: Batch UPDATEs are 100x faster than individual UPDATEs
# Recommended: 1000-2000 rows per batch
# Default: 1000
db.indexing.batch.update.size=1000

# ===== MEMORY MANAGEMENT =====
# Memory warning threshold (percentage of max heap)
# Warning logged when memory usage exceeds this threshold
app.memory.warning.threshold=80

# ===== NOTES =====
# Performance Estimates for 80K claims, 2M documents:
# - With batch UPDATEs (1000/batch): ~40-50 minutes total
# - Thread pool of 5: Processes 5 CSV files in parallel
# - Connection pool of 15: Adequate for 5 threads + overhead
#
# JVM Recommended Settings:
# -Xms2G -Xmx4G -XX:+UseG1GC -XX:MaxGCPauseMillis=200
#
# Global Processing Report:
# - Written to: {app.base_path}/CCDataIndexPackaging_Summary_Report_{timestamp}.csv
# - Contains: Total CSV files, claims, documents, batches, packaging files
# - Includes: Success/failure counts, processing time, throughput
#
# Packaging Files:
# - Written to: {app.base_path}/Packaging/wawa_migration_docs_{timestamp}.csv
# - Max rows per file: 50,000
# - Format: Pipe-delimited, 32 columns
#
# Table Change:
# - OLD: Wawa_Doc_Migration_Transit_Data
# - NEW: CC_Extract_Staging
# - Column Mapping: documentTitle -> Name
# - Missing columns in packaging output: amount, claimant, coverage, customerID, 
#   duplicate, exposureID, hidden, insuredName, primaryMembershipNumber, reviewed
#   (These will be output as empty values)

# ===========================================================================
# DATABASE QUERIES - Updated for CC_Extract_Staging table
# ===========================================================================

# SELECT query for fetching documents for one claim
# Filter conditions:
#   - claimNumber matches
#   - CC_Extract_file_Name matches (to filter by specific extract file)
#   - claimID IS NOT NULL (synced from ClaimInfo)
#   - gwDocumentID IS NOT NULL (synced from guidewireIDMapping)
#   - isDataMerged = 1 (content synced from Wawa_Doc_Migration_Transit_Data)
#   - contentFilePath IS NOT NULL (content file must exist)
#
# Column mapping from CC_Extract_Staging:
#   - Name -> documentTitle (for packaging output)
#   - Missing columns will be empty: amount, claimant, coverage, customerID,
#     duplicate, exposureID, hidden, insuredName, primaryMembershipNumber, reviewed
db.query.select.documents.by.claim=SELECT \
    externalID, \
    claimNumber, \
    CAST(claimID AS VARCHAR(50)) AS claimID, \
    gwDocumentID, \
    gwDocExternalID, \
    Name AS documentTitle, \
    documentType, \
    documentSubtype, \
    author, \
    documentDescription, \
    policyNumber, \
    doNotCreateActivity, \
    inputMethod, \
    mimeType, \
    OrigDateCreated, \
    sensitive, \
    contentFilePath, \
    contentRetrievalName, \
    contentType, \
    CC_Extract_file_Name \
FROM %TABLE_NAME% \
WHERE claimNumber = ? \
    AND CC_Extract_file_Name = ? \
    AND claimID IS NOT NULL \
    AND gwDocumentID IS NOT NULL \
    AND isDataMerged = 1 \
    AND contentFilePath IS NOT NULL \
    AND isIndexed = 0 \
ORDER BY externalID

# UPDATE query for batch indexing (setting batch/set metadata)
# Sets: batchDocCount, batchID, jobID, setDocCount, setID, SetDocIndex, isIndexed=1
db.query.update.indexing=UPDATE %TABLE_NAME% SET \
    batchDocCount = ?, \
    batchID = ?, \
    jobID = ?, \
    setDocCount = ?, \
    setID = ?, \
    SetDocIndex = ?, \
    isIndexed = 1 \
WHERE externalID = ?

# SELECT query for fetching packaging documents by batchID list
# Returns all columns needed for packaging CSV output
# Missing columns from CC_Extract_Staging will be handled in Java as empty values
db.query.select.packaging.by.batchids=SELECT \
    externalID, \
    claimNumber, \
    CAST(claimID AS VARCHAR(50)) AS claimID, \
    gwDocumentID, \
    gwDocExternalID, \
    Name AS documentTitle, \
    documentType, \
    documentSubtype, \
    author, \
    documentDescription, \
    policyNumber, \
    doNotCreateActivity, \
    inputMethod, \
    mimeType, \
    OrigDateCreated, \
    sensitive, \
    contentFilePath, \
    contentRetrievalName, \
    contentType, \
    batchDocCount, \
    batchID, \
    jobID, \
    setDocCount, \
    setID, \
    SetDocIndex, \
    CC_Extract_file_Name \
FROM %TABLE_NAME% \
WHERE batchID IN (%IN_CLAUSE%) \
    AND isDataMerged = 1 \
    AND isIndexed = 1 \
ORDER BY batchID, setID, SetDocIndex

# UPDATE query for marking documents as processed
# Sets: isProcessed=1, DateProcessed=current timestamp
db.query.update.processed=UPDATE %TABLE_NAME% SET \
    isProcessed = 1, \
    DateProcessed = ? \
WHERE externalID = ?

# ===========================================================================
# END OF CONFIGURATION
# ===========================================================================
